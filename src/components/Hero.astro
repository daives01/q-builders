---
import { config } from '../config';
---

<div id="hero-backgrounds" class="fixed inset-0 pointer-events-none z-0" aria-hidden="true">
	<img id="hero-blueprint" src={config.hero.blueprintImage} alt="" class="hero-layer absolute inset-0 w-full h-full object-cover transition-opacity duration-[var(--transition-slow)] ease-in-out" style="opacity: 1;" fetchpriority="high" />
	<img id="hero-framing" src={config.hero.framingImage} alt="" class="hero-layer absolute inset-0 w-full h-full object-cover transition-opacity duration-[var(--transition-slow)] ease-in-out hidden md:block" style="opacity: 0;" fetchpriority="high" />
	<img id="hero-house" src={config.hero.houseImage} alt="" class="hero-layer absolute inset-0 w-full h-full object-cover transition-opacity duration-[var(--transition-slow)] ease-in-out hidden md:block" style="opacity: 0;" fetchpriority="high" />
	<img id="hero-framing-mobile" src={config.hero.framingImage} alt="" class="hero-layer absolute inset-0 w-full h-full object-cover transition-opacity duration-[var(--transition-slow)] ease-in-out md:hidden" style="opacity: 0;" fetchpriority="high" />
	<img id="hero-house-mobile" src={config.hero.houseImage} alt="" class="hero-layer absolute inset-0 w-full h-full object-cover transition-opacity duration-[var(--transition-slow)] ease-in-out md:hidden" style="opacity: 0;" fetchpriority="high" />
	<div id="hero-overlay" class="absolute inset-0 bg-black/40" />
</div>

<section id="hero" class="relative h-screen z-10" aria-labelledby="hero-heading">
	<div class="absolute inset-0 flex flex-col justify-center md:justify-end px-6 md:px-16 pb-8 md:pb-40">
		<div class="max-w-7xl mx-auto w-full text-center md:text-left">
			<h1 id="hero-heading" class="text-5xl md:text-6xl lg:text-8xl font-bold text-white tracking-tight mb-6 leading-tight animate-fade-in stagger-1">
				{config.hero.headline}
			</h1>
			<p class="text-xl md:text-2xl lg:text-3xl text-white/95 mb-10 font-normal max-w-4xl md:max-w-5xl lg:max-w-7xl mx-auto md:mx-0 leading-relaxed animate-fade-in stagger-2">
				{config.hero.subline}
			</p>
		</div>
	</div>
	<div class="absolute bottom-20 left-1/2 -translate-x-1/2 z-20">
		<a href={`mailto:${config.hero.email}`} class="inline-flex items-center gap-3 bg-white hover:bg-white/90 text-stone-900 font-semibold px-6 md:px-8 py-3 md:py-4 rounded-[var(--radius-md)] transition-all duration-[var(--transition-fast)] tracking-wide group animate-fade-in stagger-3" aria-label="Start your project with Q Builders">
			<span>Start Your Project</span>
			<svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
			</svg>
		</a>
	</div>
	<div class="absolute bottom-6 left-1/2 -translate-x-1/2 animate-fade-in animate-bounce z-10" aria-hidden="true">
		<svg class="w-6 h-6 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
			<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
		</svg>
	</div>
</section>

<style>
	@keyframes fade-in {
		from { opacity: 0; transform: translateY(20px); }
		to { opacity: 1; transform: translateY(0); }
	}

	.animate-fade-in {
		animation: fade-in 1s ease-out 0.5s backwards;
	}

	.stagger-1 {
		animation-delay: 0.7s;
	}

	.stagger-2 {
		animation-delay: 0.9s;
	}

	.stagger-3 {
		animation-delay: 1.1s;
	}

	.hero-layer {
		will-change: opacity;
	}
</style>

<script>
	const initHeroEffects = () => {
		const heroSection = document.getElementById('hero');
		const blueprint = document.getElementById('hero-blueprint');
		const framing = document.getElementById('hero-framing');
		const house = document.getElementById('hero-house');
		const framingMobile = document.getElementById('hero-framing-mobile');
		const houseMobile = document.getElementById('hero-house-mobile');

		if (!heroSection || !blueprint || !framing || !house) return;

		let isDesktop = window.innerWidth >= 768;
		const transitionDistance = window.innerHeight * 4;
		const spotlightRadius = 250;

		let mouseX = 0;
		let mouseY = 0;
		let currentX = 0;
		let currentY = 0;
		let animationFrame: number | null = null;
		let ticking = false;
		let hasMovedMouse = false;

		if (isDesktop) {
			blueprint.style.opacity = '1';
			framing.style.opacity = '0';
			house.style.opacity = '0';
		} else {
			blueprint.style.opacity = '1';
			framingMobile!.style.opacity = '0';
			houseMobile!.style.opacity = '0';
		}

		const update = () => {
			if (isDesktop && hasMovedMouse) {
				currentX += (mouseX - currentX) * 0.15;
				currentY += (mouseY - currentY) * 0.15;

				const maskGradient = `radial-gradient(circle ${spotlightRadius}px at ${currentX}px ${currentY}px, transparent 0%, rgba(0,0,0,0.3) ${spotlightRadius * 0.7}px, black ${spotlightRadius}px)`;

				house.style.maskImage = maskGradient;
				house.style.webkitMaskImage = maskGradient;
				framing.style.maskImage = '';
				framing.style.webkitMaskImage = '';
				blueprint.style.maskImage = '';
				blueprint.style.webkitMaskImage = '';
			} else {
				const scrollProgress = Math.max(0, Math.min(1, window.scrollY / transitionDistance));

				let blueprintOpacity = 1;
				let framingOpacity = 0;
				let houseOpacity = 0;

				if (scrollProgress < 0.3) {
					blueprintOpacity = 1;
					framingOpacity = 0;
					houseOpacity = 0;
				} else if (scrollProgress < 0.5) {
					const localProgress = (scrollProgress - 0.3) / 0.2;
					blueprintOpacity = 1 - localProgress;
					framingOpacity = localProgress;
					houseOpacity = 0;
				} else if (scrollProgress < 0.7) {
					blueprintOpacity = 0;
					framingOpacity = 1;
					houseOpacity = 0;
				} else {
					const localProgress = (scrollProgress - 0.7) / 0.3;
					blueprintOpacity = 0;
					framingOpacity = 1 - localProgress;
					houseOpacity = localProgress;
				}

				blueprint.style.opacity = `${blueprintOpacity}`;
				if (framingMobile) framingMobile.style.opacity = `${framingOpacity}`;
				if (houseMobile) houseMobile.style.opacity = `${houseOpacity}`;
			}

			ticking = false;
		};

		const onScroll = () => {
			if (!ticking) {
				window.requestAnimationFrame(update);
				ticking = true;
			}
		};

		const onMouseMove = (e: MouseEvent) => {
			if (!isDesktop) return;
			hasMovedMouse = true;
			mouseX = e.clientX;
			mouseY = e.clientY;
		};

		const animate = () => {
			if (isDesktop) {
				update();
				animationFrame = requestAnimationFrame(animate);
			}
		};

		const startDesktopEffects = () => {
			setTimeout(() => {
				blueprint.style.opacity = '0';
				framing.style.opacity = '1';
			}, 1000);

			setTimeout(() => {
				house.style.opacity = '1';
			}, 2000);

			setTimeout(() => {
				window.addEventListener('mousemove', onMouseMove, { passive: true });
				animate();
			}, 3000);

			setTimeout(() => {
				hasMovedMouse = false;
				house.style.maskImage = '';
				house.style.webkitMaskImage = '';
			}, 6000);
		};

		window.addEventListener('scroll', onScroll, { passive: true });

		if (isDesktop) {
			startDesktopEffects();
		}

		const handleResize = () => {
			const newIsDesktop = window.innerWidth >= 768;

			if (newIsDesktop !== isDesktop) {
				isDesktop = newIsDesktop;

				window.removeEventListener('mousemove', onMouseMove);
				if (animationFrame) cancelAnimationFrame(animationFrame);
				animationFrame = null;

				if (isDesktop) {
					blueprint.style.opacity = '1';
					framing.style.opacity = '0';
					house.style.opacity = '0';
					startDesktopEffects();
				} else {
					house.style.maskImage = '';
					house.style.webkitMaskImage = '';
					framing.style.maskImage = '';
					framing.style.webkitMaskImage = '';

					blueprint.style.opacity = '1';
					if (framingMobile) framingMobile.style.opacity = '0';
					if (houseMobile) houseMobile.style.opacity = '0';
				}
			}
		};

		window.addEventListener('resize', handleResize, { passive: true });

		return () => {
			window.removeEventListener('scroll', onScroll);
			window.removeEventListener('resize', handleResize);
			window.removeEventListener('mousemove', onMouseMove);
			if (animationFrame) cancelAnimationFrame(animationFrame);
			house.style.maskImage = '';
			house.style.webkitMaskImage = '';
			framing.style.maskImage = '';
			framing.style.webkitMaskImage = '';
		};
	};

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initHeroEffects);
	} else {
		initHeroEffects();
	}
</script>
